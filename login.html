<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุฏุฎูู ุงูููุธููู - ุฌุงูุนุฉ ุงูุณูุงู ุงูุฏูููุฉ</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="long.css">
</head>
<body>

<div class="hero">
    <div class="hero-overlay"></div>

    <div class="hero-shape hero-shape-1"></div>
    <div class="hero-shape hero-shape-2"></div>

    <header class="hero-header">
        <div class="hero-uni">
            <img src="aiu-logo.png" alt="ุดุนุงุฑ ุฌุงูุนุฉ ุงูุณูุงู ุงูุฏูููุฉ" class="hero-logo">
            <div class="hero-uni-text">
                <div class="uni-name">ุฌุงูุนุฉ ุงูุณูุงู ุงูุฏูููุฉ</div>
                <div class="uni-sub">ููุธููุฉ ุดุคูู ุงูุทูุจุฉ ูุงูุงูุชุญุงูุงุช</div>
            </div>
        </div>
    </header>

    <main class="hero-main">

        <section class="hero-intro">
            <h1>ููุญุฉ ุฏุฎูู ุงูููุธููู</h1>
            <p>
                ุงูุฑุฌุงุก ุงุณุชุฎุฏุงู ุญุณุงุจู ุงูุฑุณูู ููุฏุฎูู ุฅูู ูุธุงู
                <strong>ุงูุชุณุฌููุ ุงูุฌุฏุงููุ ูุงููุชุงุฆุฌ</strong>.
            </p>
            <ul>
                <li>ุตูุงุญูุงุช ุญุณุจ ููุน ุงููุณุชุฎุฏู</li>
                <li>ุชุณุฌูู ููุฑุงุฌุนุฉ ุจูุงูุงุช ุงูุทูุจุฉ</li>
                <li>ุฅุฏุงุฑุฉ ุงูููุงุฏ ูุงููุตูู ุงูุฏุฑุงุณูุฉ</li>
            </ul>
        </section>

        <section class="login-card">
            <h2>ุฏุฎูู ุงูููุธููู</h2>

            <label class="field-label" for="user">ุงุณู ุงููุณุชุฎุฏู</label>
            <div class="field-wrapper">
                <input type="text" id="user" placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู">
            </div>

            <label class="field-label" for="pass">ูููุฉ ุงููุฑูุฑ</label>
            <div class="field-wrapper">
                <input type="password" id="pass" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ">
            </div>

            <button class="login-btn" onclick="doLogin()">
                ุฏุฎูู ุฅูู ุงููุธุงู
            </button>

            <div id="msg" class="msg"></div>

            <div class="login-footer-note">
                ูุฐุง ุงููุธุงู ูุฎุตุต ููููุธููู ุงููุฎูููู ููุท.
            </div>
        </section>

    </main>

    <footer class="hero-footer">
        <span>ยฉ ุฌุงูุนุฉ ุงูุณูุงู ุงูุฏูููุฉ</span>
        <span class="dot"></span>
        <span>ูุญุฏุฉ ูุธู ุงููุนูููุงุช</span>
        <span class="dot"></span>
        <span>ู.ุฃููุจ ุงูุญูุงุช</span>
    </footer>

</div>

<script>
    // ๐ ุฑุงุจุท ุงูููุจ ุขุจ ุงูุฃุฎูุฑ (ููุณ ุงููู ูู ุจุงูู ุงูุตูุญุงุช)
    const API_URL = "https://script.google.com/macros/s/AKfycbyBgaXcuebXQpTaHMYLx0jie1kPyUfp1JUGEZHWnF90hk20OUj4NVR6rjq_aRa0Rwr_ew/exec";

    async function doLogin() {
        const u   = document.getElementById('user').value.trim();
        const p   = document.getElementById('pass').value.trim();
        const msg = document.getElementById('msg');

        // ุชุตููุฑ ุงูุฑุณุงูุฉ ูู ูุฑุฉ
        msg.textContent = "";
        msg.classList.remove("msg-ok", "msg-error", "msg-info");

        if (!u || !p) {
            msg.textContent = "ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ";
            msg.classList.add("msg-error");
            return;
        }

        // ๐ ูุนุฑุถ ูููุณุชุฎุฏู ุฃููุง ูุงุนุฏูู ูุญุงูู ูุณุฌู ุฏุฎููู
        msg.textContent = "โณ ุฌุงุฑู ุงูุชุญูู ูู ุจูุงูุงุช ุงูุฏุฎูู...";
        msg.classList.add("msg-info");

        const url = `${API_URL}?action=login&user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`;

        try {
            const res  = await fetch(url);
            const text = await res.text();   // ูุงุฎุฏ ุงูุฑุฏ ูุตู ุฃููุงู
            console.log("RAW LOGIN RESPONSE:", text);

            let data;
            try {
                data = JSON.parse(text);
            } catch (e) {
                msg.textContent = "ุฎุทุฃ ูู ูุฑุงุกุฉ ุฑุฏ ุงูุณูุฑูุฑ (ุงูุฑุฏ ููุณ JSON).";
                msg.classList.remove("msg-info");
                msg.classList.add("msg-error");
                return;
            }

            console.log("Login API Response Parsed:", data);

            msg.classList.remove("msg-info");

            if (data.status === "OK") {
                // โ ุญูุธ ุงููุณุชุฎุฏู ูุงูุฏูุฑ ูู localStorage ุจููุงุชูุญ ููุญุฏุฉ ูููุธุงู
                const username = data.username || u;
                const role     = data.role || "";

                // ููุงุชูุญ ุนุงูุฉ ุชุณุชุฎุฏููุง ุจุงูู ุงูุตูุญุงุช
                localStorage.setItem("USERNAME", username);
                localStorage.setItem("ROLE", role);

                // ูุฎูู ููุงุชูุญู ุงููุฏููุฉ ุดุบุงูุฉ ูู ุชุจู ุชุณุชุฎุฏููุง ูุณุชูุจูุงู
                localStorage.setItem("aiu_user", username);
                localStorage.setItem("aiu_role", role);

                msg.textContent = "โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญุ ุฌุงุฑู ุงูุชุญููู...";
                msg.classList.add("msg-ok");

                setTimeout(() => {
                    window.location.href = "dashboard.html";
                }, 800);

            } else {
                // ูู ุฑุฌุน ุดูุก ุบูุฑ OKุ ูุนุฑุถู ุนุงููุงุฌูุฉ ุนุดุงู ูููู
                msg.textContent = data.message || "โ ุจูุงูุงุช ุงูุฏุฎูู ุบูุฑ ุตุญูุญุฉ ุฃู ุงูุฏูุฑ ุบูุฑ ูุถุจูุท.";
                msg.classList.add("msg-error");
            }

        } catch (err) {
            console.error("LOGIN ERROR:", err);
            msg.textContent = "๐ ุฎุทุฃ ูู ุงูุงุชุตุงู โ ุชุฃูุฏ ูู ุงูุฅูุชุฑูุช ุฃู ุฑุงุจุท ุงูู API ุฃู ุงููุดุฑ.";
            msg.classList.remove("msg-info");
            msg.classList.add("msg-error");
        }
    }
</script>
</body>
</html>
