<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ุฏุฎูู ุงูููุธููู - ุฌุงูุนุฉ ุงูุณูุงู ุงูุฏูููุฉ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="long.css">
</head>

<body>
  <div class="bg">
    <div class="mesh"></div>
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
    <div class="grain"></div>

    <header class="top">
      <div class="brand">
        <div class="logoWrap">
          <img src="aiu-logo.png" alt="ุดุนุงุฑ ุฌุงูุนุฉ ุงูุณูุงู ุงูุฏูููุฉ" class="logo" />
          <span class="ring"></span>
        </div>

        <div class="brandText">
          <div class="uni">ุฌุงูุนุฉ ุงูุณูุงู ุงูุฏูููุฉ</div>
          <div class="sub">ููุธููุฉ ุดุคูู ุงูุทูุจุฉ ูุงูุงูุชุญุงูุงุช</div>
        </div>
      </div>

      <div class="statusPill">
        <span class="dot"></span>
        <span>ุจูุงุจุฉ ุงูููุธููู</span>
      </div>
    </header>

    <main class="wrap">
      <section class="intro">
        <div class="kicker">AIU โข Smart Portal</div>
        <h1>ููุญุฉ ุฏุฎูู ุงูููุธููู</h1>
        <p>
          ุงูุฑุฌุงุก ุงุณุชุฎุฏุงู ุญุณุงุจู ุงูุฑุณูู ููุฏุฎูู ุฅูู ูุธุงู
        </p>

        <div class="features">
          <div class="feat">
            <span class="ic">๐ก๏ธ</span>
            <div>
              <div class="t">ุตูุงุญูุงุช ุฐููุฉ</div>
              <div class="d">ุญุณุจ ููุน ุงููุณุชุฎุฏู ูุงูุฏูุฑ</div>
            </div>
          </div>

          <div class="feat">
            <span class="ic">๐</span>
            <div>
              <div class="t">ุฅุฏุงุฑุฉ ุฃูุงุฏูููุฉ</div>
              <div class="d">ููุงุฏ โข ูุตูู โข ุชูุงุฑูุฑ</div>
            </div>
          </div>

          <div class="feat">
            <span class="ic">โก</span>
            <div>
              <div class="t">ุฃุฏุงุก ุณุฑูุน</div>
              <div class="d">ุชุฌุฑุจุฉ ุฏุฎูู ุณูุณุฉ</div>
            </div>
          </div>
        </div>

        <div class="miniNote">
          <span class="shield">๐</span>
          ูุฐุง ุงููุธุงู ูุฎุตุต ููููุธููู ุงููุฎูููู ููุท.
        </div>
      </section>

      <section class="card" id="card">
        <div class="cardHead">
          <div class="cardTitle">
            <span class="badge">๐</span>
            <div>
              <h2>ุฏุฎูู ุงูููุธููู</h2>
              <p>ุฃุฏุฎู ุงูุจูุงูุงุช ุซู ุงุถุบุท ุฏุฎูู</p>
            </div>
          </div>

          <button class="soundBtn" id="soundBtn" type="button" title="ุชุดุบูู/ุฅููุงู ุงูุฃุตูุงุช">
            ๐
          </button>
        </div>

        <div class="form">
          <label class="lbl" for="user">ุงุณู ุงููุณุชุฎุฏู</label>
          <div class="field">
            <span class="fieldIc">๐ค</span>
            <input type="text" id="user" placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู" autocomplete="username" />
          </div>

          <label class="lbl" for="pass">ูููุฉ ุงููุฑูุฑ</label>
          <div class="field">
            <span class="fieldIc">๐</span>
            <input type="password" id="pass" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ" autocomplete="current-password" />
            <button class="eye" id="eyeBtn" type="button" aria-label="ุฅุธูุงุฑ/ุฅุฎูุงุก ูููุฉ ุงููุฑูุฑ">๐๏ธ</button>
          </div>

          <button class="btn" id="loginBtn" type="button" onclick="doLogin()">
            <span class="btnIc" id="btnIc">โก๏ธ</span>
            <span id="btnText">ุฏุฎูู ุฅูู ุงููุธุงู</span>
            <span class="spin" id="spin" aria-hidden="true"></span>
          </button>

          <div id="msg" class="msg" role="status" aria-live="polite"></div>

          <div class="footerNote">
            ยฉ ุฌุงูุนุฉ ุงูุณูุงู ุงูุฏูููุฉ โ ูุญุฏุฉ ูุธู ุงููุนูููุงุช โ <span>ู.ุฃููุจ ุงูุญูุงุช</span>
          </div>
        </div>
      </section>
    </main>
  </div>

<script>
  // ๐ ุฑุงุจุท ุงูููุจ ุขุจ
  const API_URL = "https://script.google.com/macros/s/AKfycbwm9HtJcqNBq0eQ7fbJFaV_lrEx9EIMfsQTfhDYS7-GUc0X5LCmAZH3-UAE7myBqTVJOA/exec";

  // =============================
  // โ ูุธุงู ุงูุฃุตูุงุช (ุจุฏูู ูููุงุช)
  // =============================
  let audioEnabled = true;
  let AC = null;

  function ensureAudio() {
    if (!audioEnabled) return null;
    if (!AC) {
      const Ctx = window.AudioContext || window.webkitAudioContext;
      if (!Ctx) return null;
      AC = new Ctx();
    }
    // ุจุนุถ ุงููุชุตูุญุงุช ุชุญุชุงุฌ resume ุจุนุฏ gesture
    if (AC.state === "suspended") AC.resume().catch(()=>{});
    return AC;
  }

  function playTone({ type="sine", f=440, t=0.12, vol=0.18, attack=0.005, release=0.06, bendTo=null } = {}) {
    const ac = ensureAudio();
    if (!ac) return;

    const o = ac.createOscillator();
    const g = ac.createGain();

    o.type = type;
    o.frequency.setValueAtTime(f, ac.currentTime);

    if (bendTo) {
      o.frequency.exponentialRampToValueAtTime(bendTo, ac.currentTime + t);
    }

    g.gain.setValueAtTime(0.0001, ac.currentTime);
    g.gain.exponentialRampToValueAtTime(vol, ac.currentTime + attack);
    g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime + t + release);

    o.connect(g);
    g.connect(ac.destination);

    o.start();
    o.stop(ac.currentTime + t + release + 0.02);
  }

  function soundClick() {
    // ููุฑุฉ ูุงุนูุฉ + ููุนุฉ
    playTone({ type:"triangle", f:720, t:0.06, vol:0.12, bendTo:520 });
  }

  function soundError() {
    // ุฎุทุฃ: ูุบูุฉ ููุฎูุถุฉ + drop
    playTone({ type:"sawtooth", f:220, t:0.12, vol:0.20, bendTo:140 });
    setTimeout(()=>playTone({ type:"square", f:180, t:0.10, vol:0.14, bendTo:110 }), 80);
  }

  function soundSuccess() {
    // ูุฌุงุญ: ุซูุงุซ ูุบูุงุช ุณุฑูุนุฉ (chime)
    playTone({ type:"sine", f:523.25, t:0.10, vol:0.16 }); // C5
    setTimeout(()=>playTone({ type:"sine", f:659.25, t:0.10, vol:0.16 }), 90); // E5
    setTimeout(()=>playTone({ type:"sine", f:783.99, t:0.14, vol:0.18 }), 180); // G5
  }

  // ุฒุฑ ุงูุฃุตูุงุช
  const soundBtn = document.getElementById("soundBtn");
  soundBtn.addEventListener("click", () => {
    audioEnabled = !audioEnabled;
    soundBtn.textContent = audioEnabled ? "๐" : "๐";
    soundBtn.classList.toggle("muted", !audioEnabled);
    // ุชููุฆุฉ
    if (audioEnabled) { ensureAudio(); soundClick(); }
  });

  // ุชููุฆุฉ Audio ุนูุฏ ุฃูู ุชูุงุนู (ุญู ูุดุงูู autoplay)
  document.addEventListener("pointerdown", () => { ensureAudio(); }, { once: true });

  // ุฅุธูุงุฑ/ุฅุฎูุงุก ูููุฉ ุงููุฑูุฑ
  const eyeBtn = document.getElementById("eyeBtn");
  eyeBtn.addEventListener("click", () => {
    const pass = document.getElementById("pass");
    const isPass = pass.type === "password";
    pass.type = isPass ? "text" : "password";
    eyeBtn.textContent = isPass ? "๐" : "๐๏ธ";
    soundClick();
  });

  // Enter ููุชุณุฌูู
  ["user","pass"].forEach(id => {
    const el = document.getElementById(id);
    el.addEventListener("keydown", (e) => {
      if (e.key === "Enter") doLogin();
    });
  });

  function setLoading(isLoading) {
    const btn = document.getElementById("loginBtn");
    const spin = document.getElementById("spin");
    const btnIc = document.getElementById("btnIc");
    const btnText = document.getElementById("btnText");

    btn.disabled = isLoading;
    btn.classList.toggle("loading", isLoading);
    spin.style.display = isLoading ? "inline-block" : "none";
    btnIc.textContent = isLoading ? "โณ" : "โก๏ธ";
    btnText.textContent = isLoading ? "ุฌุงุฑู ุงูุชุญูู..." : "ุฏุฎูู ุฅูู ุงููุธุงู";
  }

  function setMsg(text, type) {
    const msg = document.getElementById("msg");
    msg.textContent = text || "";
    msg.className = "msg";
    if (type) msg.classList.add("msg-" + type);
  }

  function punchCard(kind) {
    const card = document.getElementById("card");
    card.classList.remove("shake","success");
    // ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฃููููุดู
    void card.offsetWidth;
    card.classList.add(kind);
    setTimeout(()=>card.classList.remove(kind), 650);
  }

  async function doLogin() {
    const u = document.getElementById("user").value.trim();
    const p = document.getElementById("pass").value.trim();

    setMsg("", "");
    // โ ุตูุช ุนูุฏ ุงูููุฑ
    soundClick();

    if (!u || !p) {
      setMsg("ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ", "error");
      punchCard("shake");
      soundError();
      return;
    }

    setLoading(true);
    setMsg("โณ ุฌุงุฑู ุงูุชุญูู ูู ุจูุงูุงุช ุงูุฏุฎูู...", "info");

    const url = `${API_URL}?action=login&user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`;

    try {
      const res  = await fetch(url);
      const text = await res.text();

      let data;
      try { data = JSON.parse(text); }
      catch (e) {
        setLoading(false);
        setMsg("ุฎุทุฃ ูู ูุฑุงุกุฉ ุฑุฏ ุงูุณูุฑูุฑ (ุงูุฑุฏ ููุณ JSON).", "error");
        punchCard("shake");
        soundError();
        return;
      }

      if (data.status === "OK") {
        const username = data.username || u;
        const role     = data.role || "";

        localStorage.setItem("USERNAME", username);
        localStorage.setItem("ROLE", role);
        localStorage.setItem("aiu_user", username);
        localStorage.setItem("aiu_role", role);

        setMsg("โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญุ ุฌุงุฑู ุงูุชุญููู...", "ok");
        punchCard("success");
        soundSuccess();

        setTimeout(() => {
          window.location.href = "dashboard.html";
        }, 850);

      } else {
        setLoading(false);
        setMsg(data.message || "โ ุจูุงูุงุช ุงูุฏุฎูู ุบูุฑ ุตุญูุญุฉ.", "error");
        punchCard("shake");
        soundError();
      }

    } catch (err) {
      console.error("LOGIN ERROR:", err);
      setLoading(false);
      setMsg("๐ ุฎุทุฃ ูู ุงูุงุชุตุงู โ ุชุฃูุฏ ูู ุงูุฅูุชุฑูุช ุฃู ุฑุงุจุท ุงูู API ุฃู ุงููุดุฑ.", "error");
      punchCard("shake");
      soundError();
    }
  }
</script>
</body>
</html>
